<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>레시피 검색</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    header {
      background-color: #ff6f61;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }

    header a {
      color: white;
      text-decoration: none;
      position: absolute;
      top: 20px;
      right: 20px;
    }

    #ingredient-search {
      display: flex;
      justify-content: center;
      padding: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }

    #ingredient-search input,
    #ingredient-search button {
      padding: 10px;
      font-size: 16px;
    }

    #ingredient-search input {
      width: 300px;
      max-width: 90%;
    }

    #ingredient-search button {
      cursor: pointer;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px;
    }

    .meal {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      flex: 1 1 calc(25% - 20px);
      max-width: 220px;
      transition: transform 0.2s;
    }

    .meal:hover {
      transform: scale(1.03);
    }

    .meal img {
      width: 100%;
      height: auto;
      display: block;
    }

    .meal h3 {
      text-align: center;
      padding: 10px;
      font-size: 16px;
    }

    .meal button {
      background-color: #ff6f61;
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      cursor: pointer;
    }

    .meal button:hover {
      background-color: #e65c50;
    }

    #pagination {
      display: flex;
      justify-content: center;
      padding: 20px;
      flex-wrap: wrap;
      gap: 5px;
    }

    #pagination button,
    #pagination span {
      padding: 8px 12px;
      margin: 2px;
      border: none;
      background-color: #ddd;
      cursor: pointer;
      border-radius: 5px;
    }

    #pagination button:disabled {
      background-color: #ff6f61;
      color: white;
      cursor: default;
    }

    #modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
    }

    #modal .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
    }

    #modal .close {
      float: right;
      font-size: 28px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .meal {
        flex: 1 1 calc(50% - 20px);
        max-width: 100%;
      }

      #ingredient-search {
        flex-direction: column;
        align-items: stretch;
      }

      #ingredient-search input,
      #ingredient-search button {
        width: 100%;
        margin: 5px 0;
      }

      header {
        padding: 10px;
      }

      header h1 {
        font-size: 1.8rem;
      }

      header a {
        top: 15px;
        right: 15px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>레시피 검색</h1>
    <a href="favorites.html">즐겨찾기</a>
  </header>

  <section id="ingredient-search">
    <input type="text" id="ingredient" placeholder="재료를 입력하세요" />
    <button onclick="searchByIngredient()">검색</button>
  </section>

  <section class="grid" id="meals"></section>
  <div id="pagination"></div>

  <div id="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="meal-details"></div>
    </div>
  </div>

  <script>
    let allMeals = [];
    let currentPage = 1;
    const itemsPerPage = 8;

    async function searchByIngredient() {
      const ingredient = document.getElementById("ingredient").value;
      const response = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?i=${ingredient}`);
      const data = await response.json();
      allMeals = data.meals || [];
      currentPage = 1;
      renderMeals();
      renderPagination();
    }

    function renderMeals() {
      const mealsContainer = document.getElementById("meals");
      mealsContainer.innerHTML = "";
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const mealsToShow = allMeals.slice(start, end);

      mealsToShow.forEach((meal) => {
        const mealDiv = document.createElement("div");
        mealDiv.className = "meal";
        mealDiv.innerHTML = `
          <img src="${meal.strMealThumb}" alt="${meal.strMeal}">
          <h3>${meal.strMeal}</h3>
          <button onclick="showMealDetails('${meal.idMeal}')">자세히 보기</button>
        `;
        mealsContainer.appendChild(mealDiv);
      });
    }

    function renderPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      const totalPages = Math.ceil(allMeals.length / itemsPerPage);

      if (totalPages <= 1) return;

      const makeButton = (text, page) => {
        const btn = document.createElement("button");
        btn.textContent = text;
        btn.disabled = page === currentPage;
        btn.onclick = () => {
          currentPage = page;
          renderMeals();
          renderPagination();
        };
        return btn;
      };

      if (currentPage > 1) {
        pagination.appendChild(makeButton("⟨ 이전", currentPage - 1));
      }

      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage || i === 1 || i === totalPages || Math.abs(i - currentPage) <= 1) {
          pagination.appendChild(makeButton(i, i));
        } else if (
          (i === 2 && currentPage > 4) ||
          (i === totalPages - 1 && currentPage < totalPages - 3)
        ) {
          const span = document.createElement("span");
          span.textContent = "...";
          pagination.appendChild(span);
        }
      }

      if (currentPage < totalPages) {
        pagination.appendChild(makeButton("다음 ⟩", currentPage + 1));
      }
    }

    async function showMealDetails(mealId) {
      const response = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${mealId}`);
      const data = await response.json();
      const meal = data.meals[0];

      const detailsContainer = document.getElementById("meal-details");
      detailsContainer.innerHTML = `
        <h2>${meal.strMeal}</h2>
        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" style="width: 100%; border-radius: 10px;">
        <p><strong>카테고리:</strong> ${meal.strCategory}</p>
        <p><strong>지역:</strong> ${meal.strArea}</p>
        <p><strong>재료:</strong></p>
        <ul>
          ${Array.from({ length: 20 })
            .map((_, i) => {
              const ingredient = meal[`strIngredient${i + 1}`];
              const measure = meal[`strMeasure${i + 1}`];
              return ingredient && ingredient.trim()
                ? `<li>${ingredient} - ${measure}</li>`
                : "";
            })
            .join("")}
        </ul>
        <p><strong>조리법:</strong> ${meal.strInstructions}</p>
      `;

      document.getElementById("modal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("modal").style.display = "none";
    }
  </script>
</body>
</html>
